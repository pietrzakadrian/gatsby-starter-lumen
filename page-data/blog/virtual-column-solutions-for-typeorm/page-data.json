{"componentChunkName":"component---src-templates-post-template-post-template-tsx","path":"/blog/virtual-column-solutions-for-typeorm","result":{"data":{"markdownRemark":{"id":"33072307-b14b-58bf-a417-d2c5011ada19","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f3a632970afa4814eca776f0538ade86/e5166/thumbnail.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUDBAb/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABdLmuRSUplf/EABsQAQACAgMAAAAAAAAAAAAAAAEAAwIRBBIi/9oACAEBAAEFAjtOZbNEDUfVzkj/AP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EAB0QAAIABwEAAAAAAAAAAAAAAAABEBETMTJRcZH/2gAIAQEABj8CKafTD1wc9lz/xAAcEAACAwADAQAAAAAAAAAAAAABEQAhMUFRYcH/2gAIAQEAAT8habqBzPZ7H9B9gAqbBu0JAED4n//aAAwDAQACAAMAAAAQ3P8A/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8QZ//EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAgEBPxCRj//EAB4QAQACAgEFAAAAAAAAAAAAAAEAESExQVFhobHw/9oACAEBAAE/EFUAeqThArLkNhz6eI326c0a99n7UHhQCjKxK2TKuliHioGB4n//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f3a632970afa4814eca776f0538ade86/8ac56/thumbnail.webp 240w,\n/static/f3a632970afa4814eca776f0538ade86/d3be9/thumbnail.webp 480w,\n/static/f3a632970afa4814eca776f0538ade86/e46b2/thumbnail.webp 960w,\n/static/f3a632970afa4814eca776f0538ade86/92f8c/thumbnail.webp 1200w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f3a632970afa4814eca776f0538ade86/09b79/thumbnail.jpg 240w,\n/static/f3a632970afa4814eca776f0538ade86/7cc5e/thumbnail.jpg 480w,\n/static/f3a632970afa4814eca776f0538ade86/6a068/thumbnail.jpg 960w,\n/static/f3a632970afa4814eca776f0538ade86/e5166/thumbnail.jpg 1200w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f3a632970afa4814eca776f0538ade86/6a068/thumbnail.jpg\"\n            alt=\"Thumbnail\"\n            title=\"Thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<blockquote>\n<p>❗ The below article is applicable to TypeORM in version 0.2.37 (released on 08/13/2021). Before reading, check if there is already a new version with a solution to this issue: <a href=\"https://github.com/typeorm/typeorm/releases\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">github.com/typeorm/typeorm/releases</a></p>\n</blockquote>\n<p>If you are an experienced Node.js developer and use the TypeORM library in your project, you must have encountered the problem of creating a virtual field in the data model. We need this field in order to be able to return an additional result in the response, but <strong>we don’t want to store it directly in the database</strong>.\nWhat you are most likely looking for should be named <code class=\"language-text\">.addSelectAndMap()</code>, <code class=\"language-text\">@VirtualColumn()</code> or <code class=\"language-text\">Computed Column</code> decorator.</p>\n<hr>\n<p>The creators of the library know very well about the existing problem. On 03/26/2018, @pleerock <a href=\"https://github.com/typeorm/typeorm/issues/1822#issuecomment-376069476\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">wrote</a> this comment:</p>\n<blockquote>\n<p>Official solution named addSelectAndMap will come into QueryBuilder in 0.3.0.</p>\n</blockquote>\n<p>Many people have asked the same question over the years.\nYou can read more here: <a href=\"https://github.com/typeorm/typeorm/issues/296\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">#296</a>, <a href=\"https://github.com/typeorm/typeorm/issues/1822\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">#1822</a>, <a href=\"https://github.com/typeorm/typeorm/issues/2498\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">#2498</a>, <a href=\"https://github.com/typeorm/typeorm/pull/4703\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">#4703</a>, <a href=\"https://github.com/typeorm/typeorm/pull/6855\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">#6855</a>, <a href=\"https://github.com/typeorm/typeorm/issues/7008\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">#7008</a>.</p>\n<p>This issue has not been officially resolved so far.</p>\n<hr>\n<p>In this article, I will show you all possible ways to deal with this problem. \nI sorted them out from the most insufficient to the one which fully solves this issue.</p>\n<p><em>For this article, I’m working with Nest.js framework and PostgreSQL. However, \nI am convinced that you will definitely be able to implement it in another Node.js framework, e.g. Express.js.</em></p>\n<p><em>I have also <a href=\"https://github.com/pietrzakadrian/nestjs-typeorm-virtualcolumn\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">prepared a repository</a> on github for you, in case you have any problems or want to copy the code. (each branch is a single solution)</em></p>\n<h2 id=\"1-non-selectable-column\" style=\"position:relative;\"><a href=\"#1-non-selectable-column\" aria-label=\"1 non selectable column permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Non-selectable column</h2>\n<p>The weakest solution to this problem is to create an additional field in the model with parameters that prevent SQL operations: <em>SELECT</em>, <em>INSERT</em>, <em>UPDATE</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Column<span class=\"token punctuation\">,</span> Entity<span class=\"token punctuation\">,</span> PrimaryGeneratedColumn <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"typeorm\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Entity</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"users\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserEntity</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">PrimaryGeneratedColumn</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> id<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Column</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> firstName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Column</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> lastName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Column</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> select<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> nullable<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> insert<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> update<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> fullName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The column <strong>will not be included</strong> in the model until you use the <code class=\"language-text\">.addSelect()</code> function.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Injectable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/common\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UserEntity <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../entities/user.entity\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UserRepository <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../repositories/user.repository\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> _userRepository<span class=\"token operator\">:</span> UserRepository<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>UserEntity <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> queryBuilder <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">createQueryBuilder</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    queryBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">addSelect</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">\"user.firstName || ' ' || user.lastName\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"user_fullName\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> queryBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">getOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Your controller will run the following SQL query:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span>\n\t<span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"id\"</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"firstName\"</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">\"user_firstName\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"lastName\"</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">\"user_lastName\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"firstName\"</span> <span class=\"token operator\">||</span> <span class=\"token string\">' '</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"lastName\"</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">\"user_fullName\"</span>\n<span class=\"token keyword\">FROM</span>\n\t<span class=\"token string\">\"users\"</span> <span class=\"token string\">\"user\"</span></code></pre></div>\n<p>And will return the following result in response:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"firstName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Adrian\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"lastName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Pietrzak\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"fullName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Adrian Pietrzak\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This is fine but also has very big drawback: after compiling the code, it adds \na new column in the database.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"users\"</span>\n\t<span class=\"token keyword\">ADD</span> <span class=\"token string\">\"fullName\"</span> <span class=\"token keyword\">character</span> <span class=\"token keyword\">varying</span></code></pre></div>\n<p>This is not a correct solution. We should not create strange structures in the database to be able to correctly return the result of the SQL operation. ❌</p>\n<blockquote>\n<p>thank u, next</p>\n</blockquote>\n<h2 id=\"2-getrawmethod\" style=\"position:relative;\"><a href=\"#2-getrawmethod\" aria-label=\"2 getrawmethod permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. getRaw() method</h2>\n<p>Another, still inadequate, solution is to use the built-in <code class=\"language-text\">.getRawOne()</code> or <code class=\"language-text\">.getRawMany()</code> functions.</p>\n<p>All you need to do is attach the <code class=\"language-text\">.addSelect()</code> to the query and execute your business logic in it. The function <code class=\"language-text\">.getRawOne()</code> will return the result that matches the executed SQL query.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Injectable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/common\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UserEntity <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../entities/user.entity\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UserRepository <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../repositories/user.repository\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> _userRepository<span class=\"token operator\">:</span> UserRepository<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>UserEntity <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> queryBuilder <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">createQueryBuilder</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    queryBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">addSelect</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">\"user.firstName || ' ' || user.lastName\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"user_fullName\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> queryBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">getRawOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The SQL query will be formulated as follows (same as above):</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span>\n\t<span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"id\"</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"firstName\"</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">\"user_firstName\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"lastName\"</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">\"user_lastName\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"firstName\"</span> <span class=\"token operator\">||</span> <span class=\"token string\">' '</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"lastName\"</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">\"user_fullName\"</span>\n<span class=\"token keyword\">FROM</span>\n\t<span class=\"token string\">\"users\"</span> <span class=\"token string\">\"user\"</span></code></pre></div>\n<p>And your json payload will look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"user_firstName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Adrian\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"user_lastName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Pietrzak\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"user_fullName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Adrian Pietrzak\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Formally, we have achieved the goal. Now we can add an extensive query to our model. Unfortunately, as you may have noticed, the <code class=\"language-text\">.getRawOne()</code> function does not return the mapped object. Now the output may not match the Swagger documentation and this causes additional problems.\nAlso unacceptable solution. ❌</p>\n<h2 id=\"3-subscriber-method\" style=\"position:relative;\"><a href=\"#3-subscriber-method\" aria-label=\"3 subscriber method permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Subscriber method</h2>\n<p>This solution is most often chosen by developers. It uses the subscriber <code class=\"language-text\">@AfterLoad()</code> to append each time the given result to the loaded model. Let’s look at prepared code:</p>\n<p>First, create an additional variable (not a column) in your model:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Column<span class=\"token punctuation\">,</span> Entity<span class=\"token punctuation\">,</span> PrimaryGeneratedColumn <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"typeorm\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Entity</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"users\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserEntity</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">PrimaryGeneratedColumn</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> id<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Column</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> firstName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Column</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> lastName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">public</span> fullName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Next, create a Subscriber class that will perform the intended action. Remember to load it in the appropriate place in the source code:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> EntitySubscriberInterface<span class=\"token punctuation\">,</span> EventSubscriber <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"typeorm\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UserEntity <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../entities/user.entity\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">EventSubscriber</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserSubscriber</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">EntitySubscriberInterface<span class=\"token operator\">&lt;</span>UserEntity<span class=\"token operator\">></span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> UserEntity<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">afterLoad</span><span class=\"token punctuation\">(</span>user<span class=\"token operator\">:</span> UserEntity<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    user<span class=\"token punctuation\">.</span>fullName <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span>firstName <span class=\"token operator\">+</span> <span class=\"token string\">\" \"</span> <span class=\"token operator\">+</span> user<span class=\"token punctuation\">.</span>lastName<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Module <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/common\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ConfigModule<span class=\"token punctuation\">,</span> ConfigService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/config\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> TypeOrmModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/typeorm\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UserSubscriber <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"src/user/subscribers/user.subscriber\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    TypeOrmModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRootAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>ConfigModule<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      inject<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>ConfigService<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function-variable function\">useFactory</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>configService<span class=\"token operator\">:</span> ConfigService<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        type<span class=\"token operator\">:</span> <span class=\"token string\">\"postgres\"</span><span class=\"token punctuation\">,</span>\n        host<span class=\"token operator\">:</span> configService<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"POSTGRES_HOST\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        port<span class=\"token operator\">:</span> configService<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"POSTGRES_PORT\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        username<span class=\"token operator\">:</span> configService<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"POSTGRES_USERNAME\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        password<span class=\"token operator\">:</span> configService<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"POSTGRES_PASSWORD\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        database<span class=\"token operator\">:</span> configService<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"POSTGRES_DB_NAME\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        entities<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>__dirname <span class=\"token operator\">+</span> <span class=\"token string\">\"/../**/*.entity.{js,ts}\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        synchronize<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        logging<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        subscribers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>UserSubscriber<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DatabaseModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>Our user service remains unchanged:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Injectable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/common\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UserEntity <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../entities/user.entity\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UserRepository <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../repositories/user.repository\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> _userRepository<span class=\"token operator\">:</span> UserRepository<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>UserEntity <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> queryBuilder <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">createQueryBuilder</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> queryBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">getOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now the controller will execute the following SQL query:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span>\n\t<span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"id\"</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"firstName\"</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">\"user_firstName\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"lastName\"</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">\"user_lastName\"</span>\n<span class=\"token keyword\">FROM</span>\n\t<span class=\"token string\">\"users\"</span> <span class=\"token string\">\"user\"</span></code></pre></div>\n<p>But before returning the response, it append code to the output that subscriber executes:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"firstName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Adrian\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"lastName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Pietrzak\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"fullName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Adrian Pietrzak\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Many programmers could now consider the solution to be correct. <strong>Not exactly.</strong> As I wrote earlier, your business logic will now <strong>be executed every time you try to load entity</strong>. Also when using the <code class=\"language-text\">.innerJoinAndSelect()</code> function! If you now return 25 users simultaneously, your code with the virtual field will be executed 25 times.</p>\n<p>You don’t always need to include your complicated calculations. By using the event listener, you have no control over it.</p>\n<p>Better than before, but still not perfect. ❌</p>\n<h2 id=\"4-loadrelationcountandmap-method\" style=\"position:relative;\"><a href=\"#4-loadrelationcountandmap-method\" aria-label=\"4 loadrelationcountandmap method permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. loadRelationCountAndMap() method</h2>\n<p>If you only need to pass count tightly nested relationship, you can use the built-in <code class=\"language-text\">.loadRelationCountAndMap()</code> function.\nThis allows for an extensive query.</p>\n<p>The syntax looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>UserEntity<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> queryBuilder <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">createQueryBuilder</span><span class=\"token punctuation\">(</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    queryBuilder\n       <span class=\"token punctuation\">.</span><span class=\"token function\">loadRelationCountAndMap</span><span class=\"token punctuation\">(</span>\n         <span class=\"token string\">\"images\"</span><span class=\"token punctuation\">,</span>\n         qb <span class=\"token operator\">=></span> qb<span class=\"token punctuation\">.</span><span class=\"token function\">andWhere</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"images.isRemoved = :isRemoved\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> isRemoved<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> queryBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">getOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This is a very good solution. It will always return a number, but you can also use it as boolean data. ✅</p>\n<h2 id=\"5-decorator-method\" style=\"position:relative;\"><a href=\"#5-decorator-method\" aria-label=\"5 decorator method permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. Decorator method</h2>\n<p>It would be ideal if we had a built-in <code class=\"language-text\">@VirtualColumn()</code> decorator that we declare in our model and when we use <code class=\"language-text\">.addSelect()</code> the result will be assigned to that key. So let’s just program it.</p>\n<p>Let’s start by creating a decorator:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token string\">\"reflect-metadata\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">VIRTUAL_COLUMN_KEY</span> <span class=\"token operator\">=</span> <span class=\"token function\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"VIRTUAL_COLUMN_KEY\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">VirtualColumn</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> PropertyDecorator <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> propertyKey<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> metaInfo <span class=\"token operator\">=</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">getMetadata</span><span class=\"token punctuation\">(</span><span class=\"token constant\">VIRTUAL_COLUMN_KEY</span><span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    metaInfo<span class=\"token punctuation\">[</span>propertyKey<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> name <span class=\"token operator\">??</span> propertyKey<span class=\"token punctuation\">;</span>\n\n    Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">defineMetadata</span><span class=\"token punctuation\">(</span><span class=\"token constant\">VIRTUAL_COLUMN_KEY</span><span class=\"token punctuation\">,</span> metaInfo<span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now we can import it into our entity and assign it to a new field:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> VirtualColumn <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"src/database/decorators/virtual-column.decorator\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Column<span class=\"token punctuation\">,</span> Entity<span class=\"token punctuation\">,</span> PrimaryGeneratedColumn <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"typeorm\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Entity</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"users\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserEntity</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">PrimaryGeneratedColumn</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> id<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Column</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> firstName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Column</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> lastName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">VirtualColumn</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> fullName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now we need to override the core TypeORM functions <code class=\"language-text\">.getOne()</code> and <code class=\"language-text\">.getMany()</code>. <strong>No worries!</strong> We won’t break it. We will add a few lines of code that our decorator will understand.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">VIRTUAL_COLUMN_KEY</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"src/database/decorators/virtual-column.decorator\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> SelectQueryBuilder <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"typeorm\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">\"typeorm\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">SelectQueryBuilder<span class=\"token operator\">&lt;</span>Entity<span class=\"token operator\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">getMany</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">:</span> SelectQueryBuilder<span class=\"token operator\">&lt;</span>Entity<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Entity<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">getOne</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">:</span> SelectQueryBuilder<span class=\"token operator\">&lt;</span>Entity<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Entity <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nSelectQueryBuilder<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">getMany</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> entities<span class=\"token punctuation\">,</span> raw <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRawAndEntities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> items <span class=\"token operator\">=</span> entities<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>entitiy<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> metaInfo <span class=\"token operator\">=</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">getMetadata</span><span class=\"token punctuation\">(</span><span class=\"token constant\">VIRTUAL_COLUMN_KEY</span><span class=\"token punctuation\">,</span> entitiy<span class=\"token punctuation\">)</span> <span class=\"token operator\">??</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> item <span class=\"token operator\">=</span> raw<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>propertyKey<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> Object<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">entries</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>metaInfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      entitiy<span class=\"token punctuation\">[</span>propertyKey<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> item<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> entitiy<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>items<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nSelectQueryBuilder<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">getOne</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> entities<span class=\"token punctuation\">,</span> raw <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRawAndEntities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> metaInfo <span class=\"token operator\">=</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">getMetadata</span><span class=\"token punctuation\">(</span><span class=\"token constant\">VIRTUAL_COLUMN_KEY</span><span class=\"token punctuation\">,</span> entities<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">??</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>propertyKey<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> Object<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">entries</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>metaInfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    entities<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>propertyKey<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> raw<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> entities<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>You need to implement our code in the right place for it to be compiled:</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\">import * as Joi from '@hapi/joi';\nimport { Module } from '@nestjs/common';\nimport { ConfigModule } from '@nestjs/config';\nimport { UserModule } from 'src/user/user.module';\nimport { DatabaseModule } from '../database/database.module';\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span> import './polyfill';\n</span>\n@Module({\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span> imports: [\n<span class=\"token prefix unchanged\"> </span>   ConfigModule.forRoot({\n<span class=\"token prefix unchanged\"> </span>     validationSchema: Joi.object({\n<span class=\"token prefix unchanged\"> </span>       POSTGRES_HOST: Joi.string().required(),\n<span class=\"token prefix unchanged\"> </span>       POSTGRES_PORT: Joi.number().required(),\n<span class=\"token prefix unchanged\"> </span>       POSTGRES_USERNAME: Joi.string().required(),\n<span class=\"token prefix unchanged\"> </span>       POSTGRES_PASSWORD: Joi.string().allow(''),\n<span class=\"token prefix unchanged\"> </span>       POSTGRES_DB_NAME: Joi.string().required(),\n<span class=\"token prefix unchanged\"> </span>     }),\n<span class=\"token prefix unchanged\"> </span>   }),\n<span class=\"token prefix unchanged\"> </span>   DatabaseModule,\n<span class=\"token prefix unchanged\"> </span>   UserModule,\n<span class=\"token prefix unchanged\"> </span> ],\n<span class=\"token prefix unchanged\"> </span> controllers: [],\n<span class=\"token prefix unchanged\"> </span> providers: [],\n</span>})\nexport class AppModule {}\n</code></pre></div>\n<p>I extended the user service, added an additional method to it that returns multiple users, and added the <code class=\"language-text\">.addSelect()</code> function:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Injectable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/common\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UserEntity <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../entities/user.entity\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UserRepository <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../repositories/user.repository\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> _userRepository<span class=\"token operator\">:</span> UserRepository<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">getUsers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>UserEntity<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> queryBuilder <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">createQueryBuilder</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    queryBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">addSelect</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">\"user.firstName || ' ' || user.lastName\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"fullName\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> queryBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">getMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>UserEntity <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> queryBuilder <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">createQueryBuilder</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    queryBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">addSelect</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">\"user.firstName || ' ' || user.lastName\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"fullName\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> queryBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">getOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I created an additional controller to run my functions:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Controller<span class=\"token punctuation\">,</span> Get <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/common\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UserEntity <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../entities/user.entity\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UserService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../services/user.service\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Controller</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Users\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> _userService<span class=\"token operator\">:</span> UserService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"many\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">getUsers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>UserEntity<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_userService<span class=\"token punctuation\">.</span><span class=\"token function\">getUsers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"one\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>UserEntity <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_userService<span class=\"token punctuation\">.</span><span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now, when I add the <code class=\"language-text\">.addSelect()</code> and assign the result to the virtual column name, the app will perform the following SQL operation:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span>\n\t<span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"id\"</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"firstName\"</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">\"user_firstName\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"lastName\"</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">\"user_lastName\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"firstName\"</span> <span class=\"token operator\">||</span> <span class=\"token string\">' '</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"lastName\"</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">\"fullName\"</span>\n<span class=\"token keyword\">FROM</span>\n\t<span class=\"token string\">\"users\"</span> <span class=\"token string\">\"user\"</span></code></pre></div>\n<p>And it will return the mapped model for the <code class=\"language-text\">.getOne()</code> and <code class=\"language-text\">.getMany()</code> functions, as you always wanted. 🎉</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"firstName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Adrian\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"lastName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Pietrzak\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"fullName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Adrian Pietrzak\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"firstName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Adrian\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"lastName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Pietrzak\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"fullName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Adrian Pietrzak\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"firstName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Adrian\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"lastName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Mydłowski\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"fullName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Adrian Mydłowski\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"firstName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Mateusz\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"lastName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Polski\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"fullName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Mateusz Polski\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>Now we are able to attach any query to our model without any problems,\n<strong>as you’ve always wanted</strong>. ✅</p>\n<hr>\n<p>You can also find this article on <a href=\"https://medium.com/@pietrzakadrian\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">medium.com</a> where I share my solutions to the problems I encountered during my software engineer career.</p>","timeToRead":10,"fields":{"slug":"/posts/2021-08-23---Virtual-Column-solutions-for-TypeORM//blog/virtual-column-solutions-for-typeorm","tagSlugs":["/blog/tag/typescript/","/blog/tag/nodejs/","/blog/tag/typeorm/","/blog/tag/nestjs/"]},"frontmatter":{"date":"2021-08-23T22:40:32.169Z","description":"If you are an experienced Node.js developer and use the TypeORM library in your project, you must have encountered the problem of creating a virtual field in the data model. We need this field in order to be able to return an additional result in the response, but we don't want to store it directly in the database. What you are most likely looking for should be named .addSelectAndMap(), @VirtualColumn() or Computed Column decorator.","tags":["TypeScript","NodeJS","TypeORM","NestJS"],"title":"Virtual Column solutions for TypeORM","socialImage":{"publicURL":"/static/f3a632970afa4814eca776f0538ade86/thumbnail.jpeg"}}},"allMarkdownRemark":{"edges":[{"node":{"timeToRead":21,"fields":{"tagSlugs":["/blog/tag/typescript/","/blog/tag/nodejs/","/blog/tag/nestjs/"],"categorySlug":"/blog/category/software-engineering/"},"frontmatter":{"title":"NestJS Authentication Series 🔐: Part 1 - User registration","slug":"/blog/nestjs-authentication-series/user-registration","date":"2022-02-13T22:40:32.169Z","category":"Software Engineering","description":"Welcome you to my blog series on user authentication in the NestJS framework. This series is a set of several tutorials that extend the official documentation. If you are programming an enterprise application, you will most likely want to include full user support, i.e. email account confirmation, password reminder capability, etc. This post is the first part in a series and below you can find a list of all the other articles on this topic.","tags":["TypeScript","NodeJS","NestJS"],"socialImage":{"publicURL":"/static/917b994c0ced5f3b467420f6e0010217/thumbnail.jpeg"}}}},{"node":{"timeToRead":11,"fields":{"tagSlugs":["/blog/tag/nodejs/","/blog/tag/typescript/","/blog/tag/nestjs/"],"categorySlug":"/blog/category/software-engineering/"},"frontmatter":{"title":"How to create a microservice that handles 🎢 the queue of sending emails in NestJS","slug":"/blog/how-to-create-a-microservice-that-handles-the-queue-of-sending-emails-in-nestjs","date":"2021-12-01T12:40:32.169Z","category":"Software Engineering","description":"In this article, I will present you independent microservice that handles the queue of sending emails using the Node.js platform with the NestJS framework. The use of this microservice allows you to decouple the business logic of the email senders from the main monolithic application, resulting in less use of server resources and therefore faster source code execution.","tags":["NodeJS","TypeScript","NestJS"],"socialImage":{"publicURL":"/static/5d7467fd82762ea414353f94589606ed/thumbnail.jpeg"}}}}]}},"pageContext":{"slug":"/posts/2021-08-23---Virtual-Column-solutions-for-TypeORM//blog/virtual-column-solutions-for-typeorm","groups":["TypeScript","NodeJS","TypeORM","NestJS"],"id":"33072307-b14b-58bf-a417-d2c5011ada19"}},"staticQueryHashes":["251939775","2764776372","401334301","63107425"]}