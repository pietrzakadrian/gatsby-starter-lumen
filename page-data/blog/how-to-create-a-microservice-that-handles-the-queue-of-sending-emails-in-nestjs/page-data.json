{"componentChunkName":"component---src-templates-post-template-post-template-tsx","path":"/blog/how-to-create-a-microservice-that-handles-the-queue-of-sending-emails-in-nestjs","result":{"data":{"markdownRemark":{"id":"f538b05a-3bc2-5cbd-ab69-101e0e57663c","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5d7467fd82762ea414353f94589606ed/e5166/thumbnail.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMBAgX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAAB1m3mEjhP/8QAGRAAAwADAAAAAAAAAAAAAAAAAAERAhAS/9oACAEBAAEFArkVnbEpv//EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAwEBPwFlf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABgQAAIDAAAAAAAAAAAAAAAAAAIQIDJB/9oACAEBAAY/AtVCh//EABkQAQEAAwEAAAAAAAAAAAAAAAERABAhMf/aAAgBAQABPyHAj2Unk7dUAA3/AP/aAAwDAQACAAMAAAAQX9//xAAXEQADAQAAAAAAAAAAAAAAAAAAARFh/9oACAEDAQE/EGqaH//EABcRAAMBAAAAAAAAAAAAAAAAAAABEVH/2gAIAQIBAT8QRVh//8QAHRABAAIBBQEAAAAAAAAAAAAAAREhABAxUZHR8f/aAAgBAQABPxCLdhPDOVOHc2ds+Ce4fKAQWuv/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5d7467fd82762ea414353f94589606ed/8ac56/thumbnail.webp 240w,\n/static/5d7467fd82762ea414353f94589606ed/d3be9/thumbnail.webp 480w,\n/static/5d7467fd82762ea414353f94589606ed/e46b2/thumbnail.webp 960w,\n/static/5d7467fd82762ea414353f94589606ed/92f8c/thumbnail.webp 1200w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5d7467fd82762ea414353f94589606ed/09b79/thumbnail.jpg 240w,\n/static/5d7467fd82762ea414353f94589606ed/7cc5e/thumbnail.jpg 480w,\n/static/5d7467fd82762ea414353f94589606ed/6a068/thumbnail.jpg 960w,\n/static/5d7467fd82762ea414353f94589606ed/e5166/thumbnail.jpg 1200w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5d7467fd82762ea414353f94589606ed/6a068/thumbnail.jpg\"\n            alt=\"Thumbnail\"\n            title=\"Thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>In this article, I will present you independent microservice that handles the queue of sending emails using the Node.js platform with the NestJS framework.</p>\n<p>The use of this microservice allows you to decouple the business logic of the email senders from the main monolithic application, resulting in less use of server resources and therefore faster source code execution.</p>\n<blockquote>\n<p><strong>Note</strong>: As usual, I have prepared a ready-made repository for you with code from this article.<br>\nYou can find it <a href=\"https://github.com/pietrzakadrian/nestjs-mailer-microservice\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>.</p>\n</blockquote>\n<blockquote>\n<p><strong>Note</strong>: This article is an expanded version of <a href=\"https://firxworx.com/blog/coding/nodejs/email-module-for-nestjs-with-bull-queue-and-the-nest-mailer/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this post</a>. It contains better described source code and microservice implementations.</p>\n</blockquote>\n<hr>\n<h2 id=\"architecture-of-microservice\" style=\"position:relative;\"><a href=\"#architecture-of-microservice\" aria-label=\"architecture of microservice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Architecture of microservice</h2>\n<p>I have tried to keep this software as simple as possible. Below is the directory structure:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.\n├── app\n│   └── index.ts\n├── mail\n│   ├── constants\n│   │   ├── mail.constant.ts\n│   │   └── index.ts\n│   ├── controllers\n│   │   ├── mail.controller.ts\n│   │   └── index.ts\n│   ├── processors\n│   │   ├── mail.processor.ts\n│   │   └── index.ts\n│   ├── services\n│   │   ├── mail.service.ts\n│   │   └── index.ts\n│   ├── templates\n│   │   └── registration.hbs\n│   ├── tests\n│   │   ├── mail.controller.spec.ts\n│   │   └── mail.service.spec.ts\n│   └── index.ts\n└── main.ts</code></pre></div>\n<p>As you can see, there are only a few files and I will guide you through each one.</p>\n<hr>\n<h2 id=\"1-installation-and-configuration-of-project-files\" style=\"position:relative;\"><a href=\"#1-installation-and-configuration-of-project-files\" aria-label=\"1 installation and configuration of project files permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Installation and configuration of project files</h2>\n<p>According to the <a href=\"https://docs.nestjs.com/microservices/basics\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">official NestJS documentation</a>, to create a microservice you need to install the <code class=\"language-text\">@nestjs/microservices</code> module in the <a href=\"https://docs.nestjs.com/#installation\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">NestJS starter application</a>.</p>\n<p>This version of the software is more professional, so we’ll install a bit more of them.<br>\nExecute these two lines of code in your terminal while in the root directory of the project.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">yarn add @nestjs/microservices @nestjs/bull @nestjs-modules/mailer @hapi/joi bull handlebars nodemailer @nestjs/config</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">yarn add @types/bull @types/hapi__joi @types/nodemailer --dev</code></pre></div>\n<p>You will be using the handlebars template engine, which uses the <strong>.hbs</strong> file format. NestJS needs to know this because by default it only compiles files containing TypeScript code.</p>\n<p>Edit the <strong>nest-cli.json</strong> file, which is located in the root directory of the project.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"collection\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"@nestjs/schematics\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"sourceRoot\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"src\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"compilerOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"assets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"mail/templates/**/*\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p><strong>Note</strong>: You will need redis installed on your server to support the queue. The configuration of this database is simple. Installing it goes beyond the topic of this article. Consult the documentation on the <a href=\"https://redis.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">official redis website</a>.</p>\n</blockquote>\n<hr>\n<h2 id=\"2-environment-variables\" style=\"position:relative;\"><a href=\"#2-environment-variables\" aria-label=\"2 environment variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Environment variables</h2>\n<p>It’s time to create the first file. So let’s start by configuring the environment variables. Create an <strong>.env</strong> file in the root directory of your project:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># Email Settings\nEMAIL_HOST=smtp.gmail.com\nEMAIL_PORT=465\nEMAIL_ADDRESS=mailer-microservice@gmail.com\nEMAIL_PASSWORD=P4ssw0rd!$\n\n# Redis Settings\nREDIS_HOST=localhost\nREDIS_PORT=6379</code></pre></div>\n<blockquote>\n<p><strong>Note</strong>: If you want to use gmail to send emails, remember to <a href=\"https://myaccount.google.com/lesssecureapps\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">enable access to less secure applications</a>.</p>\n</blockquote>\n<p>Now we link the environment variables to the main module, which is located in <strong>app/index.ts</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> BullModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/bull\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Module <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/common\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ConfigModule<span class=\"token punctuation\">,</span> ConfigService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/config\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Joi <span class=\"token keyword\">from</span> <span class=\"token string\">\"@hapi/joi\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    BullModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRootAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>ConfigModule<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function-variable function\">useFactory</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>configService<span class=\"token operator\">:</span> ConfigService<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        redis<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          host<span class=\"token operator\">:</span> configService<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REDIS_HOST\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          port<span class=\"token operator\">:</span> <span class=\"token operator\">+</span>configService<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REDIS_PORT\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      inject<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>ConfigService<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    ConfigModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      validationSchema<span class=\"token operator\">:</span> Joi<span class=\"token punctuation\">.</span><span class=\"token function\">object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token constant\">EMAIL_HOST</span><span class=\"token operator\">:</span> Joi<span class=\"token punctuation\">.</span><span class=\"token function\">string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token constant\">EMAIL_PORT</span><span class=\"token operator\">:</span> Joi<span class=\"token punctuation\">.</span><span class=\"token function\">number</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token constant\">EMAIL_ADDRESS</span><span class=\"token operator\">:</span> Joi<span class=\"token punctuation\">.</span><span class=\"token function\">string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token constant\">EMAIL_PASSWORD</span><span class=\"token operator\">:</span> Joi<span class=\"token punctuation\">.</span><span class=\"token function\">string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token constant\">REDIS_HOST</span><span class=\"token operator\">:</span> Joi<span class=\"token punctuation\">.</span><span class=\"token function\">string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token constant\">REDIS_PORT</span><span class=\"token operator\">:</span> Joi<span class=\"token punctuation\">.</span><span class=\"token function\">number</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <strong>main.ts</strong> file is identical, just like in the official documentation.<br>\nHowever, I will paste it here just so that this article remains complete.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NestFactory <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/core\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Transport<span class=\"token punctuation\">,</span> MicroserviceOptions <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/microservices\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AppModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./app\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">bootstrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> NestFactory<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">createMicroservice</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>MicroserviceOptions<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n    AppModule<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> transport<span class=\"token operator\">:</span> Transport<span class=\"token punctuation\">.</span><span class=\"token constant\">TCP</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  app<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">bootstrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<hr>\n<h2 id=\"3-programming-the-mail-module\" style=\"position:relative;\"><a href=\"#3-programming-the-mail-module\" aria-label=\"3 programming the mail module permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Programming the Mail module</h2>\n<p>Ok, now we can do what tigers 🐅 like the most, which is to program the mail module that will be responsible for all the logic. Let’s start with the simplest one, which is programming the constants.</p>\n<h3 id=\"31-create-the-constants-file\" style=\"position:relative;\"><a href=\"#31-create-the-constants-file\" aria-label=\"31 create the constants file permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.1. Create the constants file</h3>\n<p>In the constants directory, create the file <strong>mail.constant.ts</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">MAIL_QUEUE</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"MAIL_QUEUE\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">CONFIRM_REGISTRATION</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"CONFIRM_REGISTRATION\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p><strong>Note</strong>: You may have already noticed that each directory contains an <strong>index.ts</strong> file. It contains an export of the entire contents of all files in that directory. This allows for elegant import paths.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./mail.constant\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">MAIL_QUEUE</code> is a variable representing the name of the queue, and <code class=\"language-text\">CONFIRM_REGISTRATION</code> is the name of the process being executed. In our case, we are creating an account registration confirmation mailing.</p>\n<h3 id=\"32-create-a-mail-template\" style=\"position:relative;\"><a href=\"#32-create-a-mail-template\" aria-label=\"32 create a mail template permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.2. Create a mail template</h3>\n<p>As I wrote earlier, we use the handlebars template engine. This is a popular solution for Node.js applications. It allows you to pass variables, create loops and more.</p>\n<p>Create <strong>registration.hbs</strong> file in templates directory:</p>\n<div class=\"gatsby-highlight\" data-language=\"handlebars\"><pre class=\"language-handlebars\"><code class=\"language-handlebars\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    Yo 😄\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/></span></span>\n    Thank you for registering in our app.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/></span></span>\n    Click on the link to confirm your account.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token handlebars language-handlebars\"><span class=\"token delimiter punctuation\">{{</span><span class=\"token variable\">confirmUrl</span><span class=\"token delimiter punctuation\">}}</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h3 id=\"33-create-a-mail-processor\" style=\"position:relative;\"><a href=\"#33-create-a-mail-processor\" aria-label=\"33 create a mail processor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.3. Create a mail processor</h3>\n<p>The processor is responsible for processing tasks in the queue. I added comments to places in the code that are very important.</p>\n<p>In the processors directory, create <strong>mail.processor.ts</strong> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MailerService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs-modules/mailer\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Process<span class=\"token punctuation\">,</span> Processor <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/bull\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Injectable<span class=\"token punctuation\">,</span> Logger <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/common\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ConfigService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/config\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Job <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"bull\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">CONFIRM_REGISTRATION</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MAIL_QUEUE</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../constants\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Processor</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">MAIL_QUEUE</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MailProcessor</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> _logger <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Logger</span><span class=\"token punctuation\">(</span>MailProcessor<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> _mailerService<span class=\"token operator\">:</span> MailerService<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> _configService<span class=\"token operator\">:</span> ConfigService<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Process</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">CONFIRM_REGISTRATION</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// here is the name of the executed process</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">confirmRegistration</span><span class=\"token punctuation\">(</span>\n    job<span class=\"token operator\">:</span> Job<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">{</span> emailAddress<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> confirmUrl<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_logger<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n      <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Sending confirm registration email to '</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>job<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>emailAddress<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">'</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_mailerService<span class=\"token punctuation\">.</span><span class=\"token function\">sendMail</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        to<span class=\"token operator\">:</span> job<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>emailAddress<span class=\"token punctuation\">,</span>\n        from<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_configService<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"EMAIL_ADDRESS\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        subject<span class=\"token operator\">:</span> <span class=\"token string\">\"Registration\"</span><span class=\"token punctuation\">,</span>\n        template<span class=\"token operator\">:</span> <span class=\"token string\">\"./registration\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// ! it must point to a template file name without the .hbs extension</span>\n        context<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> confirmUrl<span class=\"token operator\">:</span> job<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>confirmUrl <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// here you pass the variables that you use in the hbs template</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_logger<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>\n        <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Failed to send confirmation email to '</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>job<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>emailAddress<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">'</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>If you want more information about queued tasks, you can add an additional 3 methods:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">OnQueueActive</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token function\">onActive</span><span class=\"token punctuation\">(</span>job<span class=\"token operator\">:</span> Job<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_logger<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Processing job </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>job<span class=\"token punctuation\">.</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> of type </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>job<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">OnQueueCompleted</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token function\">onComplete</span><span class=\"token punctuation\">(</span>job<span class=\"token operator\">:</span> Job<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_logger<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Completed job </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>job<span class=\"token punctuation\">.</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> of type </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>job<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">OnQueueFailed</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token function\">onError</span><span class=\"token punctuation\">(</span>job<span class=\"token operator\">:</span> Job<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> error<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_logger<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Failed job </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>job<span class=\"token punctuation\">.</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> of type </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>job<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>error<span class=\"token punctuation\">.</span>message<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    error<span class=\"token punctuation\">.</span>stack<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p><strong>Note</strong>: You can read more about queues in the <a href=\"https://docs.nestjs.com/techniques/queues\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">official NestJS documentation</a>.</p>\n</blockquote>\n<h3 id=\"34-create-a-mail-service\" style=\"position:relative;\"><a href=\"#34-create-a-mail-service\" aria-label=\"34 create a mail service permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.4. Create a mail service</h3>\n<p>We will now program a service to add a new task (i.e. sending an email) to the queue.<br>\nIn the services directory, create a file named <strong>mail.service.ts</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Injectable<span class=\"token punctuation\">,</span> Logger <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/common\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">CONFIRM_REGISTRATION</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MAIL_QUEUE</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../constants\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Queue <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"bull\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> InjectQueue <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/bull\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MailService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> _logger <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Logger</span><span class=\"token punctuation\">(</span>MailService<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">InjectQueue</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">MAIL_QUEUE</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> _mailQueue<span class=\"token operator\">:</span> Queue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">sendConfirmationEmail</span><span class=\"token punctuation\">(</span>\n    emailAddress<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n    confirmUrl<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_mailQueue<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CONFIRM_REGISTRATION</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        emailAddress<span class=\"token punctuation\">,</span>\n        confirmUrl<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_logger<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>\n        <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Error queueing registration email to user </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>emailAddress<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">throw</span> error<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I think this method is simple enough that there is no need to describe it.</p>\n<h3 id=\"35-create-a-mail-controller\" style=\"position:relative;\"><a href=\"#35-create-a-mail-controller\" aria-label=\"35 create a mail controller permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.5. Create a mail controller</h3>\n<p>Once we have the service and processor programmed, we need to create a controller to run it all.<br>\nCreate a <strong>mail.controller.ts</strong> file in the controllers directory.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Controller <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/common\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> EventPattern <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/microservices\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MailService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../services\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Controller</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MailController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> _mailService<span class=\"token operator\">:</span> MailService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">EventPattern</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> cmd<span class=\"token operator\">:</span> <span class=\"token string\">\"send-message\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">sendConfirmationEmail</span><span class=\"token punctuation\">(</span>\n    emailAddress<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n    confirmUrl<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_mailService<span class=\"token punctuation\">.</span><span class=\"token function\">sendConfirmationEmail</span><span class=\"token punctuation\">(</span>emailAddress<span class=\"token punctuation\">,</span> confirmUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p><strong>Note</strong>: this microservice will listen for the <code class=\"language-text\">send-message</code> command. You can read more about it <a href=\"https://docs.nestjs.com/microservices/basics#event-based\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>.</p>\n</blockquote>\n<h3 id=\"36-inject-created-classes-into-the-main-module-file\" style=\"position:relative;\"><a href=\"#36-inject-created-classes-into-the-main-module-file\" aria-label=\"36 inject created classes into the main module file permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.6. Inject created classes into the main module file</h3>\n<p>We already have everything we need. We just need to combine it in the main module file.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ConfigModule<span class=\"token punctuation\">,</span> ConfigService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/config\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Module <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/common\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MailerModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs-modules/mailer\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> HandlebarsAdapter <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs-modules/mailer/dist/adapters/handlebars.adapter\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> BullModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/bull\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">MAIL_QUEUE</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./constants\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MailProcessor <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./processors\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MailService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./services\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MailController <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./controllers\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    ConfigModule<span class=\"token punctuation\">,</span>\n    MailerModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRootAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>ConfigModule<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      inject<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>ConfigService<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function-variable function\">useFactory</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>configService<span class=\"token operator\">:</span> ConfigService<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        transport<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          host<span class=\"token operator\">:</span> configService<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"EMAIL_HOST\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          port<span class=\"token operator\">:</span> <span class=\"token operator\">+</span>configService<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"EMAIL_PORT\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          secure<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n          auth<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            user<span class=\"token operator\">:</span> configService<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"EMAIL_ADDRESS\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            pass<span class=\"token operator\">:</span> configService<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"EMAIL_PASSWORD\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          tls<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> rejectUnauthorized<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        defaults<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> from<span class=\"token operator\">:</span> <span class=\"token string\">'\"NestJS Mailer\" &lt;test@test.com>'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// the header of the received emails is defined here. Customize this for your application.</span>\n        template<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          dir<span class=\"token operator\">:</span> __dirname <span class=\"token operator\">+</span> <span class=\"token string\">\"/templates\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// here you must specify the path where the directory with all email templates is located</span>\n          adapter<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HandlebarsAdapter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> strict<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    BullModule<span class=\"token punctuation\">.</span><span class=\"token function\">registerQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      name<span class=\"token operator\">:</span> <span class=\"token constant\">MAIL_QUEUE</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>MailProcessor<span class=\"token punctuation\">,</span> MailService<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  exports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>MailService<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  controllers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>MailController<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MailModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>Do not forget to import the created module into the main module of the application:</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\">...\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span> import { MailModule } from 'src/mail';\n</span>\n@Module({\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span> imports: [\n<span class=\"token prefix unchanged\"> </span>   ...\n</span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span>   MailModule,\n</span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span> ],\n</span>})\nexport class AppModule {}</code></pre></div>\n<p>So that’s it. We have the whole module programmed and ready to use! 🚀<br>\nYou can now compile the application and run it on an external server.</p>\n<hr>\n<h2 id=\"example-of-use\" style=\"position:relative;\"><a href=\"#example-of-use\" aria-label=\"example of use permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example of use</h2>\n<p>Implementing a microservice in NestJS is trivially easy. We need to import a specific module for connection and apply it to our service.\nIn our case, we will send an email address when a user is created.</p>\n<ol>\n<li>First, you need to start microservices in your <strong>main.ts</strong> file (in another NestJS application):</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token operator\">...</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MicroserviceOptions<span class=\"token punctuation\">,</span> Transport <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/microservices'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ConfigService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/config'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">bootstrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n\n  <span class=\"token keyword\">await</span> app<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">connectMicroservice</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>MicroserviceOptions<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    transport<span class=\"token operator\">:</span> Transport<span class=\"token punctuation\">.</span><span class=\"token constant\">TCP</span><span class=\"token punctuation\">,</span>\n    options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      port<span class=\"token operator\">:</span> configService<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PORT'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  app<span class=\"token punctuation\">.</span><span class=\"token function\">startAllMicroservices</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">bootstrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"2\">\n<li>In the module where you will want to use the microservice, declare a new object in the providers array:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token operator\">...</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ClientProxyFactory<span class=\"token punctuation\">,</span> Transport <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/microservices'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      provide<span class=\"token operator\">:</span> <span class=\"token string\">'MAIL_SERVICE'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function-variable function\">useFactory</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        ClientProxyFactory<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          transport<span class=\"token operator\">:</span> Transport<span class=\"token punctuation\">.</span><span class=\"token constant\">TCP</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthenticationModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">MAIL_SERVICE</code> is the name of the microservice. You will refer to it through the constructor in the service.</p>\n<ol start=\"3\">\n<li>Now apply the client at the appropriate place in your business logic:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token operator\">...</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ClientProxy <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/microservices'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthenticationService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'MAIL_SERVICE'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">private</span> client<span class=\"token operator\">:</span> ClientProxy<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token operator\">...</span>\n\n   <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">registration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> emailAddress <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> RegistrationDto<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>UserEntity<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n     <span class=\"token operator\">...</span>\n\n     <span class=\"token keyword\">const</span> confirmUrl <span class=\"token operator\">=</span> <span class=\"token string\">\"https://link.test?ey=testexample2\"</span>\n     <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>subscribersService<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> cmd<span class=\"token operator\">:</span> <span class=\"token string\">'send-message'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> emailAddress<span class=\"token punctuation\">,</span> confirmUrl <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Remember that the cmd must be identical to the one defined in the microservice controller.\nIn the second argument, you pass the variables you need to send to the microservice.</p>\n<p>That’s it, your monolithic application now is associated with the microservice and can use its services. 🙌</p>\n<hr>\n<h2 id=\"testing-the-mail-module\" style=\"position:relative;\"><a href=\"#testing-the-mail-module\" aria-label=\"testing the mail module permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Testing the mail module</h2>\n<p>The more experienced a developer I am, the more I realize how important testing is. My tests aren’t perfect, but I’m glad they are.</p>\n<p>Below is my test named <strong>mail.controller.spec.ts</strong> for the mail controller:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> BullModule<span class=\"token punctuation\">,</span> getQueueToken <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/bull\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Test<span class=\"token punctuation\">,</span> TestingModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/testing\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">MAIL_QUEUE</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../constants\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MailController <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../controllers\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MailService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../services\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MailController\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> controller<span class=\"token operator\">:</span> MailController<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> moduleRef<span class=\"token operator\">:</span> TestingModule<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> exampleQueueMock <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> add<span class=\"token operator\">:</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    jest<span class=\"token punctuation\">.</span><span class=\"token function\">resetAllMocks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    moduleRef <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Test<span class=\"token punctuation\">.</span><span class=\"token function\">createTestingModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        BullModule<span class=\"token punctuation\">.</span><span class=\"token function\">registerQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          name<span class=\"token operator\">:</span> <span class=\"token constant\">MAIL_QUEUE</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      controllers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>MailController<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>MailService<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">overrideProvider</span><span class=\"token punctuation\">(</span><span class=\"token function\">getQueueToken</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MAIL_QUEUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">useValue</span><span class=\"token punctuation\">(</span>exampleQueueMock<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">compile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    controller <span class=\"token operator\">=</span> moduleRef<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>MailController<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>MailController<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should be defined\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>controller<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeDefined</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>I also wrote a test for the mail service:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> BullModule<span class=\"token punctuation\">,</span> getQueueToken <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/bull\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Test<span class=\"token punctuation\">,</span> TestingModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/testing\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Queue <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"bull\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">MAIL_QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CONFIRM_REGISTRATION</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../constants\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MailService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../services\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MailService\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> service<span class=\"token operator\">:</span> MailService<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> moduleRef<span class=\"token operator\">:</span> TestingModule<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> exampleQueueMock <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> add<span class=\"token operator\">:</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    jest<span class=\"token punctuation\">.</span><span class=\"token function\">resetAllMocks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    moduleRef <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Test<span class=\"token punctuation\">.</span><span class=\"token function\">createTestingModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        BullModule<span class=\"token punctuation\">.</span><span class=\"token function\">registerQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          name<span class=\"token operator\">:</span> <span class=\"token constant\">MAIL_QUEUE</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>MailService<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">overrideProvider</span><span class=\"token punctuation\">(</span><span class=\"token function\">getQueueToken</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MAIL_QUEUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">useValue</span><span class=\"token punctuation\">(</span>exampleQueueMock<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">compile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    service <span class=\"token operator\">=</span> moduleRef<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>MailService<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>MailService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should inject the queue\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> queue <span class=\"token operator\">=</span> moduleRef<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Queue<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token function\">getQueueToken</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MAIL_QUEUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeDefined</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should be defined\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeDefined</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should dispatch job\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> service<span class=\"token punctuation\">.</span><span class=\"token function\">sendConfirmationEmail</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">\"test@test.com\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"http://link.com?token=ey\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>exampleQueueMock<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CONFIRM_REGISTRATION</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      confirmUrl<span class=\"token operator\">:</span> <span class=\"token string\">\"http://link.com?token=ey\"</span><span class=\"token punctuation\">,</span>\n      emailAddress<span class=\"token operator\">:</span> <span class=\"token string\">\"test@test.com\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>After executing yarn test, you will get the following result:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ jest\n PASS  src/mail/tests/mail.service.spec.ts\n PASS  src/mail/tests/mail.controller.spec.ts\nTest Suites: 2 passed, 2 total\nTests:       4 passed, 4 total\nSnapshots:   0 total\nTime:        5.225 s\nRan all test suites.\n✨  Done in 6.56s.</code></pre></div>\n<hr>\n<p>In this article, we learned how to implement a queue for sending e-mails using a microservice.\nWe have written a comprehensive application and prepared tests for it.</p>\n<p>You can also find this article on <a href=\"https://medium.com/@pietrzakadrian\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">medium.com</a> where I share my solutions to the problems I encountered during my software engineer career.</p>","timeToRead":11,"fields":{"slug":"/posts/2021-12-01---How-to-create-a-microservice-that-handles-the-queue-of-sending-emails-in-nestjs//blog/how-to-create-a-microservice-that-handles-the-queue-of-sending-emails-in-nestjs","tagSlugs":["/blog/tag/nodejs/","/blog/tag/typescript/","/blog/tag/nestjs/"]},"frontmatter":{"date":"2021-12-01T12:40:32.169Z","description":"In this article, I will present you independent microservice that handles the queue of sending emails using the Node.js platform with the NestJS framework. The use of this microservice allows you to decouple the business logic of the email senders from the main monolithic application, resulting in less use of server resources and therefore faster source code execution.","tags":["NodeJS","TypeScript","NestJS"],"title":"How to create a microservice that handles 🎢 the queue of sending emails in NestJS","socialImage":{"publicURL":"/static/5d7467fd82762ea414353f94589606ed/thumbnail.jpeg"}}},"allMarkdownRemark":{"edges":[{"node":{"timeToRead":21,"fields":{"tagSlugs":["/blog/tag/typescript/","/blog/tag/nodejs/","/blog/tag/nestjs/"],"categorySlug":"/blog/category/software-engineering/"},"frontmatter":{"title":"NestJS Authentication Series 🔐: Part 1 - User registration","slug":"/blog/nestjs-authentication-series/user-registration","date":"2022-02-13T22:40:32.169Z","category":"Software Engineering","description":"Welcome you to my blog series on user authentication in the NestJS framework. This series is a set of several tutorials that extend the official documentation. If you are programming an enterprise application, you will most likely want to include full user support, i.e. email account confirmation, password reminder capability, etc. This post is the first part in a series and below you can find a list of all the other articles on this topic.","tags":["TypeScript","NodeJS","NestJS"],"socialImage":{"publicURL":"/static/917b994c0ced5f3b467420f6e0010217/thumbnail.jpeg"}}}},{"node":{"timeToRead":3,"fields":{"tagSlugs":["/blog/tag/nodejs/","/blog/tag/typescript/","/blog/tag/react/"],"categorySlug":"/blog/category/open-source/"},"frontmatter":{"title":"⭐️ How did my open source project get over 1k stars on GitHub?","slug":"/blog/how-did-my-open-source-project-get-over-1k-stars-on-github","date":"2021-11-23T12:40:32.169Z","category":"Open Source","description":"In 2019, I started working on my first larger software application than \"todo list\". I was looking for a job as a software developer this year and I needed to distinguish myself from other developers. I made a banking system where you could make transfers (not real money). I've been looking for help from other developers to find out if my JavaScript code is good enough. By coincidence, my application has become one of the most popular open source projects and has received over 1.2k stars up to date.","tags":["NodeJS","TypeScript","React"],"socialImage":{"publicURL":"/static/a4c72404693d15415fceeaaaa10e11fb/thumbnail.jpeg"}}}}]}},"pageContext":{"slug":"/posts/2021-12-01---How-to-create-a-microservice-that-handles-the-queue-of-sending-emails-in-nestjs//blog/how-to-create-a-microservice-that-handles-the-queue-of-sending-emails-in-nestjs","groups":["NodeJS","TypeScript","NestJS"],"id":"f538b05a-3bc2-5cbd-ab69-101e0e57663c"}},"staticQueryHashes":["251939775","2764776372","401334301","63107425"]}